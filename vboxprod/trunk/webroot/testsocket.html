<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd" >
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- $Id: index.html 554 2013-08-17 13:53:53Z imoore76 $ -->
<!-- Copyright (C) 2010-2013 Ian Moore (imoore76 at yahoo dot com) -->
<head>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
        <meta http-equiv="Expires" content="0"/>
        <meta http-equiv="Cache-Control" content ="no-cache"/>
        <meta http-equiv="Cache-Control" content ="no-store, must-revalidate, max-age=0"/>
        <meta http-equiv="Cache-Control" content ="post-check=0, pre-check=0"/>
        <meta http-equiv="Pragma" content="no-cache"/>
        
       	<script src="extjs/ext-all-dev.js" type='text/javascript'></script>
       	<script src="extjs/ux/Deferred.js" type='text/javascript'></script>
       	
       	<script type="text/javascript" src="lib/web-socket-js/swfobject.js"></script>
		<script type="text/javascript" src="lib/web-socket-js/web_socket.js"></script>
        

	<title>vcube</title>
<script type='text/javascript'>

WEB_SOCKET_DEBUG = true
WEB_SOCKET_SWF_LOCATION = "lib/web-socket-js/WebSocketMain.swf";

var gp = null;
function waitUntil() {
	if(gp) return gp;
	gp = Ext.create('Ext.ux.Deferred');
	window.setTimeout(function(){gp.resolve('asdf');},3000);
	return gp;
}
function testDeferred() {
	Ext.ux.Deferred.when(waitUntil()).done(function(d){
		console.log("here1 adsf with " + d);
	});
	Ext.ux.Deferred.when(waitUntil()).done(function(d){
		console.log("here2 with " + d);
	});
	
	window.setTimeout(function(){
		Ext.ux.Deferred.when(waitUntil()).done(function(d){
			console.log("Here3 with " + d);
		});
	}, 5000);
}
function printOut() {
	for(var i = 0; i < arguments.length; i++) {
		console.log("args");
		console.log(arguments[i]);
	}
	console.log(arguments);
}
function getEvents() {
	
	var stuff = ['I','Just','want','this'];
	
	 printOut.apply(null, stuff);
	 
	 return;
	  // Write your code in the same way as for native WebSocket:
	  var ws = new WebSocket("ws://" + location.host + "/eventStream");
	  ws.onmessage = function(e) {
	    // Receives a message.
	    console.log(e.data);
	  };
	  ws.onclose = function() {
	    console.log("----------------CLOSED --------------")
	    getEvents()
	  };
	  ws.onopen = function() {
	    console.log("opened...")
	    ws.send("Hello");  // Sends a message.
		  ws.send("pookajspdoifjpaosdijf");
	  };
	  
}

</script>
</head>
<body onload="testDeferred()">
<div id='something'>
nothing yet
</div>
</body>
</html>